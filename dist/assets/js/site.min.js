var lastFmRecords=function(){function a(a){s&&"undefined"!=typeof console&&"function"==typeof console.log&&console.log("object"==typeof a?a:"last.fm.records: "+a)}function b(){var a=!1;switch(m){case"lovedtracks":a="user.getlovedtracks";break;case"topalbums":a="user.gettopalbums";break;case"overall":case"7day":case"3month":case"6month":case"12month":a="user.gettopalbums&period="+m;break;default:a="user.getrecenttracks"}jQuery.getJSON(x+"?method="+a+"&user="+l+"&api_key="+w+"&limit=50&format=json&callback=?",lastFmRecords.processLastFmData)}function c(a){jQuery.getJSON(x+"?method=artist.getinfo&mbid="+a+"&api_key="+w+"&format=json&callback=?",lastFmRecords.processArtistData)}function d(b){var c,d=!1;return jQuery.each(b,function(a,b){"error"==a&&(d=!0,c=" ("+b+")"),d&&"message"==a&&(c=b+c)}),d&&a("last.fm reported error: "+c),d}function e(a){return _biggestYet=!1,jQuery.each(a,function(a,b){return"large"==b.size?(_biggestYet=b["#text"],!1):void("medium"==b.size?_biggestYet=b["#text"]:"small"==b.size&&""==_biggestYet&&(_biggestYet=b["#text"]))}),y==_biggestYet?!1:_biggestYet}function f(b){if(d(b))return!1;switch(m){case"recenttracks":b=b.recenttracks.track;break;case"lovedtracks":b=b.lovedtracks.track;break;default:b=b.topalbums.album}return b?(b.name&&"string"==typeof b.name&&(b=[b]),jQuery.each(b,function(a,b){if(a>n)return!1;var c=[];c.cdcover=b.image?e(b.image):!1,c.artistname=b.artist["#text"]||b.artist.name,c.artistmbid=b.artist.mbid,c.name=b.name,c.mbid=b.mbid,c.url="http://"==b.url.substr(0,7).toLowerCase()?b.url:"http://"+b.url,c.time="recenttracks"==m?b["@attr"]&&"true"==b["@attr"].nowplaying?"listening now":"undefined"==typeof b.date?"some time":i(b.date["#text"],t):"",g(a,c)}),void(p>0&&setTimeout("lastFmRecords.refreshCovers();",6e4*p))):(a("No return data from Last.fm"),!1)}function g(b,d){jQuery.each(d,function(a,c){jQuery("#lastfmcover"+b).data(a,c)});var e=d.name+" by "+d.artistname;""!=d.time&&(e+=" ("+d.time+")"),jQuery("#lastfmcover"+b).attr("title",e),""==d.cdcover?v[d.artistmbid]&&"*"!=v[d.artistmbid]?jQuery("#lastfmcover"+b).attr("src",v[d.artistmbid]):("*"!=v[d.artistmbid]&&(d.artistmbid?(a("cover for "+d.name+" not found, trying to find image of artist "+d.artistname),v[d.artistmbid]="*",c(d.artistmbid)):a("no last.fm data found for artist "+d.artistname)),jQuery("#lastfmcover"+b).attr("src",r),jQuery("#lastfmcover"+b).addClass(d.artistmbid)):jQuery("#lastfmcover"+b).attr("src",d.cdcover).parent("a").attr("href",d.url).unbind("click",lastFmRecords.dontFollowLink)}function h(a){return d(a)?!1:void jQuery.each(a,function(a,b){return _imgurl=e(b.image),_mbid=b.mbid,jQuery("."+_mbid).each(function(){jQuery(this).attr("src",_imgurl).removeClass(_mbid).parent("a").attr("href",b.url).unbind("click",lastFmRecords.dontFollowLink)}),v[_mbid]=_imgurl,!1})}function i(a,b){var c=new Date-new Date(a);c-=6e4*b*60;var d=[];d.ye=parseInt(c/31536e6),d.da=parseInt(c/864e5)-365*d.ye,d.ho=parseInt(c/36e5)-365*d.ye*24-24*d.da,d.mi=parseInt(c/6e4)-365*d.ye*24*60-24*d.da*60-60*d.ho;var e=[];return d.ye>0&&e.push(d.ye+" year"+j(d.ye)),d.da>0&&e.push(d.da+" day"+j(d.da)),d.ho>0&&e.push(d.ho+" hour"+j(d.ho)),d.mi>0&&e.push(d.mi+" minute"+j(d.mi)),e.join(", ")+" ago"}function j(a){return 1==a?"":"s"}function k(b,c,d){var e=[];return e.msg=b,e.url=c,e.line=d,e.ref=document.location.href,a(e),!1}var l,m="recenttracks",n=6,o="",p=3,q="lastfmrecords",r="http://cdn.last.fm/depth/catalogue/noimage/cover_85px.gif",s=!1,t="+1",u=0,v=[],w="fbfa856cc3af93c43359b57921b1e64e",x="http://ws.audioscrobbler.com/2.0/",y="http://cdn.last.fm/flatness/catalogue/noimage/2/default_album_medium.png";return{addStyle:function(){a("function addStyle not supported yet")},setUser:function(a){l=a},setPeriod:function(a){m=a},setCount:function(a){var b=parseInt(a);b>0&&(n=b)},setStyle:function(a){o=a},setPlaceholder:function(a){q=a},setDefaultThumb:function(a){r=a},setRefreshMinutes:function(a){var b=parseInt(a);b>0&&(p=b)},setTimeOffset:function(a){t=parseInt(a)},setLinkNewScreen:function(a){u="1"==a},debug:function(){s=!0},err:function(a,b,c){k(a,b,c)},dontFollowLink:function(){return!1},init:function(c){a("initializing"),jQuery(window).bind("error",lastFmRecords.err),a("registering error handler"),c.placeholder&&this.setPlaceholder(c.placeholder);var d=/\[lastfmrecords\|[a-z]+\|[0-9]+\]/,e=document.body.innerHTML.match(d);if(a(e),e&&(document.body.innerHTML=document.body.innerHTML.replace(d,"<div id="+q+"></div>"),e=e[0].replace("[","").replace("]","").split("|"),a("Hey, that's nice, this site is using the [lastfmrecords|period|count] way of showing covers."),e[1]&&(c.period=e[1],a("Changing period to "+e[1])),e[2]&&(c.count=e[2],a("Changing number of covers to "+e[2]))),jQuery("div#"+q).length<1)return a("error: placeholder for cd covers not found"),!1;if(c.username&&this.setUser(c.username),c.period&&this.setPeriod(c.period),c.defaultthumb&&this.setDefaultThumb(c.defaultthumb),c.count&&this.setCount(c.count),c.refresh&&this.setRefreshMinutes(c.refresh),c.offset&&this.setTimeOffset(c.offset),c.styletype&&this.setStyle(c.styletype),c.linknewscreen&&this.setLinkNewScreen(c.linknewscreen),"1"==c.debug&&this.debug(),a(l),!l)return a("No last.fm username available. Impossible to fetch listening habits. Goodbye."),!1;"recenttracks"!=m&&(p=0);var f=jQuery("<ol></ol>").appendTo("div#"+q);f||a("error: placeholder for cd covers not found"),a("adding temporary cd covers");for(var g,h,i=0;n>i;i++)h=jQuery("<li></li>").attr("style","display: inline;"),_a=jQuery("<a></a>").bind("click",lastFmRecords.dontFollowLink).attr("href","").appendTo(h),"highslide"==o?_a.click(function(){return hs.expand(this)}):"lightbox"==o?_a.attr("rel","lightbox"):"1"==u&&_a.attr("target","_blank"),g=jQuery("<img></img>").attr("src",r).attr("id","lastfmcover"+i).error(function(){jQuery(this).attr("src",r)}).appendTo(_a),h.appendTo(f);b()},refreshCovers:function(){b()},processLastFmData:function(a){f(a)},processArtistData:function(a){h(a)}}}();$(function(){var a=window.location.pathname,b=a.split("/").pop(),c=b.split(".html").shift(),d=$("a.nav-menu__link");d.each(function(){var a=$(this).attr("href").split(".html").shift();a===c&&$(this).parent().addClass("active")});var e=768;if($(window).width()<=e){var f=$("ul#mobile-nav-menu");$("button#mobile-menu-toggle").on("click",function(){f.slideToggle()})}switch(c){case"work":var g=$.listFilter({animate:!0,speed:"slow",filterOptionsList:$("ul#filter-list"),listToFilter:$("ul#portfolio-list")});g.init(),$(".carousel").slick({lazyLoad:"ondemand",autoplay:!0,autoplaySpeed:5e3,infinite:!0});break;case"contact":var h=$.contactForm();$("input#send").on("click",function(a){a.preventDefault(),$("span.error-msg").hide(),h.validate()})}window.lastFmRecords.init({username:"KopiJunkie",count:5,period:"lovedtracks",defaultthumb:"http://cdn.last.fm/flatness/catalogue/noimage/2/default_album_large.png"}),$("#lastfmrecords a").append("<span class='vinyl'></span>"),$("#lastfmrecords a").hover(function(){$(this).children(".vinyl").stop(!0,!0).animate({left:"78px"},500)},function(){$(this).children(".vinyl").animate({left:"28px"},500)});var i=moment();$("#year").text(" "+i.year())}),function(a){a.listFilter=function(b){var c={settings:a.extend({animate:!1,filterOptionsList:a("ul#filter-list"),listToFilter:a("ul#list")},b),init:function(){if(window.console){if(c.settings.filterOptionsList.length<1)return void console.log("ERROR (listFilter): filterOptionsList option element not found");if(c.settings.listToFilter.length<1)return void console.log("ERROR (listFilter): listToFilter option element not found")}var b=c.settings.filterOptionsList.find("li");window.console&&b.length<1&&console.log("WARNING (listFilter): filterOptionsList option does not have any <li> elements");var d=c.settings.filterOptionsList.find("li.active"),e=d.text().trim().toLowerCase().replace(" ","-");c.filterListBy(e),b.on("click",function(b){b.preventDefault(),c.settings.filterOptionsList.find("li").removeClass("active"),a(this).addClass("active");var d=a(this).text().trim().toLowerCase().replace(" ","-");c.filterListBy(d)})},filterListBy:function(b){var d=c.settings.listToFilter;window.console&&d.length<1&&console.log("WARNING (listFilter): listToFilter option does not have any <li> elements"),c.settings.animate?"all"===b?d.find("li").fadeIn(c.settings.speed):d.find("li").each(function(){var d=a(this);d.hasClass(b)?d.fadeIn(c.settings.speed):d.fadeOut(c.settings.speed)}):"all"===b?d.find("li").show():d.find("li").each(function(){var c=a(this);c.hasClass(b)?c.show():c.hide()})}};return{init:c.init}}}(jQuery),function(a){a.contactForm=function(){var b=a("#contact-form"),c={validate:function(){var d=c.validateValues();if(0===d){var e=b.serialize();c.sendMessage(e)}else a(".form__input").on("keyup",function(){var b="#"+a(this).attr("id")+"-required",c="#"+a(this).attr("id")+"-invalid",d=a(this).val().trim();d.length>0?(a(this).removeClass("error"),a(b).hide(),a(c).hide()):(a(this).addClass("error"),a(c).hide(),a(b).show())})},validateValues:function(){var b=0,c=a("#name"),d=c.val().trim();0===d.length&&(b++,c.addClass("error"),a("#name-required").show());var e=a("#email"),f=e.val().trim(),g=/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/;0===f.length?(b++,e.addClass("error"),a("#email-required").show()):g.test(f)||(b++,e.addClass("error"),a("#email-invalid").show());var h=a("#message"),i=h.val().trim();return 0===i.length&&(b++,h.addClass("error"),a("#message-required").show()),b},sendMessage:function(c){console.log("send message!",c),a.ajax({type:"POST",url:"assets/php/send.php",data:c,success:function(){b.slideUp("slow"),a(".send-success-msg").slideDown("slow")},error:function(){a(".send-error-msg").slideDown("slow")}})}};return{validate:c.validate}}}(jQuery);